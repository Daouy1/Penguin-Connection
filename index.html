<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>游냖 Penguin Connection 游냖</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="CSS/Style.css">
    <link rel="icon" href="Imagenes/Icon.jpg">
</head>

<body>
    <header>
        <h1>
            游냖 Penguin Connection 游냖
        </h1>
    </header>

    <nav>
        <ul>
            <li>
                <a href="index.html">
                    Inicio
                </a>
            </li>
            <li>
                <a href="comunidades.html">
                    Comunidades
                </a>
            </li>
            <li>
                <a href="iniciarSesion.html">
                    Iniciar Sesi칩n
                </a>
            </li>
            <li>
                <a href="registrarse.html">
                    Registrarse
                </a>
            </li>
            <li>
                <a href="miCuenta.html">
                    Mi Cuenta
                </a>
            </li>
        </ul>
    </nav>

    <main>
        <div class="Contenido">
            <h2>
                칔ltimas Publicaciones
            </h2>

            <a href="formPubli.html">
                <button id="btnPublicar">
                    Publicar
                </button>
            </a>

            <div id="publicacionesContainer">
                <!-- Aqu칤 se cargar치n las publicaciones -->
            </div>
        </div>

        <div class="PanelLateral">
            <h2>
                Panel Lateral
            </h2>

            <p id="Reproductor">
                <b>游땙 M칰sica Fachera del Espacio 游땙</b>
            </p>
            <audio id="audioPlayer" controls>
                Tu navegador no soporta la etiqueta de audio.
            </audio>
            <ul id="MusicList" class="columnas">
                <!-- Aqu칤 se cargar치n las canciones de Spotify -->
            </ul>

            <script>
                async function getSpotifyToken() {
                    const client_id = '514da01a59054288bc732002cb738242';
                    const client_secret = '861867b5f40c47838da7d1e0bfa40992';
                    const response = await fetch('https://accounts.spotify.com/api/token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'Authorization': 'Basic ' + btoa(client_id + ':' + client_secret)
                        },
                        body: 'grant_type=client_credentials'
                    });
                    const data = await response.json();
                    return data.access_token;
                }

                async function getSpotifyTracks(token) {
                    const response = await fetch('https://api.spotify.com/v1/playlists/TU_PLAYLIST_ID/tracks', {
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });
                    const data = await response.json();
                    return data.items;
                }

                function cambiarCancion(ruta) {
                    var Reproductor = document.getElementById('audioPlayer');
                    Reproductor.src = ruta;
                    Reproductor.play();
                }

                document.addEventListener('DOMContentLoaded', async function () {
                    const token = await getSpotifyToken();
                    const tracks = await getSpotifyTracks(token);
                    const musicList = document.getElementById('MusicList');

                    tracks.forEach(track => {
                        const trackElement = document.createElement('li');
                        trackElement.innerHTML = `
                            <button onclick="cambiarCancion('${track.track.preview_url}')" id="btnMusic">
                                ${track.track.name}
                            </button>`;
                        musicList.appendChild(trackElement);
                    });

                    fetch('get_publicaciones.php')
                        .then(response => response.json())
                        .then(data => {
                            const publicacionesContainer = document.getElementById('publicacionesContainer');
                            data.forEach(publicacion => {
                                const publicacionElement = document.createElement('div');
                                publicacionElement.className = 'publicacion';
                                publicacionElement.innerHTML = `<a href="ver_publicacion.php?id=${publicacion.id}"><h3>${publicacion.title}</h3></a>`;
                                publicacionesContainer.appendChild(publicacionElement);
                            });
                        });
                });
            </script>
        </div>
    </main>

    <footer>
        <p>&copy; P치gina creada por Daouy</p>
    </footer>
</body>

</html>
